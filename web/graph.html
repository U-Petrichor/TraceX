<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TraceX Atlas - 攻击图谱</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&family=Noto+Sans+SC:wght@300;400;500;600;700&family=Noto+Serif+SC:wght@400;500;600;700&family=Space+Grotesk:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="assets/styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js" defer></script>
    <script src="assets/app.js?v=2" defer></script>
    <script src="assets/graph.js?v=2" defer></script>
    <script src="assets/apt.js?v=2" defer></script>
  </head>
  <body data-page="graph">
    <header class="topbar">
      <div class="brand">
        <div class="brand-mark"></div>
        <span>TraceX Atlas</span>
      </div>
      <nav class="nav">
        <a href="dashboard.html" data-nav="dashboard">总览</a>
        <a href="threats.html" data-nav="threats">威胁</a>
        <a href="graph.html" data-nav="graph">攻击图谱</a>
        <a href="logs.html" data-nav="logs">日志</a>
      </nav>
      <div class="top-controls">
        <div class="status-pill" data-tone="live">
          <span class="status-dot"></span>
          <span class="js-status">在线</span>
        </div>
        <button class="button secondary" data-toggle-panel aria-expanded="false">数据源</button>
      </div>
      <div class="data-panel" data-panel hidden>
        <div class="panel-head">
          <div class="panel-title">API 地址</div>
          <button class="panel-close" type="button" data-panel-close>关闭</button>
        </div>
        <div class="input-group">
          <input class="input" id="apiBaseInput" type="text" placeholder="http://localhost:8000" />
          <button class="button" id="apiBaseSave">保存</button>
        </div>
        <div class="inline-note">提示：使用 FastAPI 服务地址或反向代理。</div>
      </div>
    </header>

    <main class="graph-layout">
      <section class="page-head graph-head">
        <div>
          <div class="tag">攻击图谱</div>
          <h1 class="hero-title">将横向移动可视化为实时图谱</h1>
          <p class="hero-subtitle">节点与连线仅来自高价值事件</p>
        </div>
        <div class="input-group graph-controls">
          <select class="select" id="dataSelect" aria-label="数据集">
            <option value="TheLastTest" selected>TheLastTest (实时验证)</option>
          </select>
          <!-- Mode selection removed, defaulting to Direct TTP -->
          <button class="button secondary" id="playBtn" type="button">播放</button>
          <button class="button secondary" id="pauseBtn" type="button">暂停</button>
          <button class="button" id="rebuildBtn">重建图谱</button>
        </div>
      </section>

      <section class="grid cols-3 graph-metrics">
        <div class="card" data-delay="1">
          <div class="card-header">
            <div class="card-title">节点</div>
            <span class="badge">实体</span>
          </div>
          <div class="card-value" id="nodeCount">--</div>
          <div class="card-sub">主机 / IP / 用户</div>
        </div>
        <div class="card" data-delay="2">
          <div class="card-header">
            <div class="card-title">连线</div>
            <span class="badge safe">关系</span>
          </div>
          <div class="card-value" id="edgeCount">--</div>
          <div class="card-sub">行为路径</div>
        </div>
        <div class="card" data-delay="3">
          <div class="card-header">
            <div class="card-title">聚焦</div>
            <span class="badge warn">热区</span>
          </div>
          <div class="card-value">实时</div>
          <div class="card-sub">高价值轨迹</div>
        </div>
      </section>

      <section class="grid cols-2 graph-stage">
        <div class="panel graph-panel">
          <div class="panel-header">
            <div class="panel-title">攻击关系图</div>
            <span class="inline-note">交互式力导向</span>
          </div>
          <div id="graphCanvas" class="chart"></div>
        </div>
        <div class="panel graph-side">
          <div class="panel-section">
            <div class="panel-header">
              <div class="panel-title">路径洞察</div>
              <span class="inline-note">最新路径</span>
            </div>
            <div class="list" id="flowList"></div>
          </div>
          <div class="divider"></div>
          <div class="panel-section">
            <div class="panel-header">
              <div class="panel-title">溯源顺序</div>
              <span class="inline-note">起点到终点</span>
            </div>
            <div class="sequence-rail" id="sequenceList"></div>
          </div>
        </div>
      </section>

      <section class="panel apt-summary-panel">
        <div class="panel-header">
          <div class="panel-title">APT 模拟输出</div>
          <span class="inline-note" id="aptMeta">等待数据</span>
        </div>
        <div class="grid cols-4 apt-summary">
          <div class="card">
            <div class="card-header">
              <div class="card-title">APT 模拟</div>
              <span class="badge safe">ATLAS</span>
            </div>
            <div class="card-value" id="aptName">--</div>
            <div class="card-sub" id="aptAliases">别名 --</div>
          </div>
          <div class="card">
            <div class="card-header">
              <div class="card-title">模式</div>
              <span class="badge">链路</span>
            </div>
            <div class="card-value" id="aptMode">--</div>
            <div class="card-sub">攻击链推演</div>
          </div>
          <div class="card">
            <div class="card-header">
              <div class="card-title">事件数</div>
              <span class="badge warn">TTP</span>
            </div>
            <div class="card-value" id="aptEventCount">--</div>
            <div class="card-sub">输入日志</div>
          </div>
          <div class="card">
            <div class="card-header">
              <div class="card-title">图谱规模</div>
              <span class="badge safe">关系</span>
            </div>
            <div class="card-value" id="aptGraphScale">--</div>
            <div class="card-sub">
              <span id="aptNodeCount">--</span> 节点 · <span id="aptEdgeCount">--</span> 边
            </div>
          </div>
        </div>
      </section>

      <section class="grid cols-2 apt-grid">
        <div class="panel">
          <div class="panel-header">
            <div class="panel-title">攻击链签名 (ATLAS)</div>
            <span class="inline-note">关键动作序列</span>
          </div>
          <div class="apt-chain" id="aptSignature"></div>
        </div>
        <div class="panel">
          <div class="panel-header">
            <div class="panel-title">TTP 归因结果</div>
            <span class="inline-note">疑似组织匹配</span>
          </div>
          <div class="apt-kpis">
            <div class="apt-kpi">
              <div class="inline-note">疑似组织</div>
              <div class="apt-metric" id="aptSuspected">--</div>
            </div>
            <div class="apt-kpi">
              <div class="inline-note">置信度</div>
              <div class="apt-metric" id="aptConfidence">--</div>
            </div>
            <div class="apt-kpi">
              <div class="inline-note">Jaccard</div>
              <div class="apt-metric" id="aptJaccard">--</div>
            </div>
            <div class="apt-kpi">
              <div class="inline-note">召回率</div>
              <div class="apt-metric" id="aptRecall">--</div>
            </div>
          </div>
          <div class="divider"></div>
          <div class="panel-section">
            <div class="panel-header">
              <div class="panel-title">匹配 TTP</div>
              <span class="inline-note" id="aptTtpCount">--</span>
            </div>
            <div class="apt-tags" id="aptMatchedTtps"></div>
          </div>
          <div class="panel-section">
            <div class="panel-header">
              <div class="panel-title">Top 匹配</div>
              <span class="inline-note">相似度排行</span>
            </div>
            <div class="apt-match-list" id="aptTopMatches"></div>
          </div>
        </div>
        <div class="panel apt-span-2">
          <div class="panel-header">
            <div class="panel-title">攻击链条结构</div>
            <span class="inline-note">节点 → 边 → 节点</span>
          </div>
          <div class="apt-structure" id="aptStructure"></div>
        </div>
        <div class="panel">
          <div class="panel-header">
            <div class="panel-title">APT Profile</div>
            <span class="inline-note">画像与关联技法</span>
          </div>
          <div class="apt-profile-grid">
            <div class="apt-profile-item">
              <div class="inline-note">组织名称</div>
              <div class="apt-metric" id="aptProfileName">--</div>
            </div>
            <div class="apt-profile-item">
              <div class="inline-note">别名数量</div>
              <div class="apt-metric" id="aptAliasCount">--</div>
            </div>
            <div class="apt-profile-item">
              <div class="inline-note">技法数量</div>
              <div class="apt-metric" id="aptProfileTtpCount">--</div>
            </div>
          </div>
          <div class="panel-section">
            <div class="panel-header">
              <div class="panel-title">组织描述</div>
            </div>
            <div class="apt-description" id="aptProfileDescription" style="font-size: 0.9em; line-height: 1.6; color: var(--text-secondary); margin-top: 0.5rem;">--</div>
          </div>
          <div class="panel-section">
            <div class="panel-header">
              <div class="panel-title">MITRE 信息</div>
            </div>
            <div class="apt-profile-grid" style="grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 0.5rem;">
              <div class="apt-profile-item">
                <div class="inline-note">MITRE ID</div>
                <div class="apt-metric" id="aptProfileMitreId" style="font-size: 1.2rem;">--</div>
              </div>
              <div class="apt-profile-item">
                <div class="inline-note">链接</div>
                <a id="aptProfileUrl" href="#" target="_blank" class="button small secondary" style="text-decoration: none; display: inline-flex; justify-content: center; align-items: center; width: fit-content;">查看详情</a>
              </div>
            </div>
          </div>
          <div class="panel-section">
            <div class="panel-header">
              <div class="panel-title">别名</div>
              <span class="inline-note">APT 组织别称</span>
            </div>
            <div class="apt-tags" id="aptProfileAliases"></div>
          </div>
          <div class="panel-section">
            <div class="panel-header">
              <div class="panel-title">核心 TTP</div>
              <span class="inline-note">Top 技法</span>
            </div>
            <div class="apt-tags" id="aptProfileTtps"></div>
          </div>
          <div class="panel-section">
            <div class="panel-header">
              <div class="panel-title">目标行业</div>
              <span class="inline-note">情报视角</span>
            </div>
            <div class="apt-tags" id="aptProfileIndustries"></div>
          </div>
        </div>
        <div class="panel apt-span-2">
          <div class="panel-header">
            <div class="panel-title">IOC 富化结果</div>
            <span class="inline-note">风险评分与标签</span>
          </div>
          <div class="apt-ioc-grid" id="aptIocGrid"></div>
        </div>
      </section>
    </main>

    <footer class="footer">
      <div>TraceX Atlas 可视化</div>
      <div class="mono">攻击图谱视图</div>
    </footer>
  </body>
</html>
