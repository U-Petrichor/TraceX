# 组员1任务详解：主机日志采集

## 任务概览
负责 Linux 主机日志的采集、解析与标准化，重点关注系统审计日志（Auditd）和系统日志（Syslog）。

## 1. Filebeat 安装与配置

主机日志采集依赖 Filebeat 将本地日志（Auditd, Syslog）发送到 Elasticsearch。

### 1. Filebeat 安装与配置

### 1.1 安装方式：Docker 容器

为了保证环境的一致性，我们采用 Docker 容器方式运行 Filebeat，而非直接安装在宿主机。

### 1.2 配置步骤

更新 `docker-compose.yml`，Filebeat 会作为其中的一个服务自动启动。

**您只需要执行以下操作：**

1.  **确保 Docker 环境正常**
    ```bash
    # 在项目根目录下
    docker-compose up -d
    ```
    这会自动拉取并启动 `filebeat-collector` 容器。

2.  **配置原理 (已自动处理)**
    *   **配置文件**: 我们创建了 `collector/host_collector/filebeat.yml`，它会被挂载到容器内。
    *   **日志挂载**: 宿主机的 `/var/log` 目录被挂载到容器的 `/hostfs/var/log`，以便 Filebeat 读取宿主机的 auditd 日志。

3.  **验证状态**
    ```bash
    docker ps | grep filebeat
    # 应该能看到 filebeat-collector 正在运行
    ```

### 1.3 验证采集

运行测试脚本，它会模拟主机操作并检查数据是否入库：

```bash
# 备份原配置
sudo mv /etc/filebeat/filebeat.yml /etc/filebeat/filebeat.yml.bak

# 写入新配置 (请确保缩进正确)
sudo tee /etc/filebeat/filebeat.yml > /dev/null <<EOF
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/audit/audit.log
  pipeline: "auditd-pipeline"

- type: log
  enabled: true
  paths:
    - /var/log/syslog
    - /var/log/messages
  pipeline: "syslog-pipeline"

setup.ilm.enabled: false
setup.template.name: "unified-logs"
setup.template.pattern: "unified-logs-*"
setup.template.overwrite: true

output.elasticsearch:
  hosts: ["localhost:9200"]
  index: "unified-logs-%{+yyyy.MM.dd}"
EOF
```

### 1.3 启动服务

```bash
sudo systemctl daemon-reload
sudo systemctl enable filebeat
sudo systemctl start filebeat

# 检查状态
sudo systemctl status filebeat
```
