# 组员1任务详解：主机日志采集

## 任务概览
负责 Linux 主机日志的采集、解析与标准化，重点关注系统审计日志（Auditd）和系统日志（Syslog）。

## 1. Filebeat 安装与配置

主机日志采集依赖 Filebeat 将本地日志（Auditd, Syslog）发送到 Elasticsearch。

### 1.1 安装 Filebeat (Ubuntu/Debian)

```bash
curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.17.9-amd64.deb
sudo dpkg -i filebeat-7.17.9-amd64.deb
```

### 1.2 配置 Filebeat

**方案 A：自动配置（推荐）**

直接运行 Host Collector 的测试脚本，它会自动检测并修复 Filebeat 配置：

```bash
# 需要 root 权限来修改配置
sudo python3 tests/test_host_collector.py
```

**方案 B：手动配置**

如果您不想运行测试，请修改 `/etc/filebeat/filebeat.yml`，参考 `collector/host_collector/filebeat_config.py` 中的内容，或者直接覆盖：

```bash
# 备份原配置
sudo mv /etc/filebeat/filebeat.yml /etc/filebeat/filebeat.yml.bak

# 写入新配置 (请确保缩进正确)
sudo tee /etc/filebeat/filebeat.yml > /dev/null <<EOF
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/audit/audit.log
  pipeline: "auditd-pipeline"

- type: log
  enabled: true
  paths:
    - /var/log/syslog
    - /var/log/messages
  pipeline: "syslog-pipeline"

setup.ilm.enabled: false
setup.template.name: "unified-logs"
setup.template.pattern: "unified-logs-*"
setup.template.overwrite: true

output.elasticsearch:
  hosts: ["localhost:9200"]
  index: "unified-logs-%{+yyyy.MM.dd}"
EOF
```

### 1.3 启动服务

```bash
sudo systemctl daemon-reload
sudo systemctl enable filebeat
sudo systemctl start filebeat

# 检查状态
sudo systemctl status filebeat
```
