# 🛡️ 恶意攻击行为溯源分析系统 - 基础设施与开发规范

## 1. 环境配置说明

本系统目前部署于服务器（Ubuntu 22.04），已完成核心存储层与基础设施的搭建：

- **容器化引擎**: Docker + Docker Compose 插件。
    
- **存储中心**: Elasticsearch 7.17.9（监听端口：`9200`）。
    
- **可视化平台**: Kibana 7.17.9（监听端口：`5601`）。
    
- **网络环境**: 内部 Docker 网络 `attack-range`（网段：`172.20.0.0/24`）。
    

## 2. 软件依赖要求

所有组员在各自模块开发前，请确保安装以下 Python 库以匹配服务器环境：

Bash

```
pip install elasticsearch==7.17.9
```

## 3. 项目目录结构

请严格遵守以下目录结构进行代码提交，严禁随意修改 `common` 文件夹内容：

- `collector/common/`: **公共模块**，包含数据规范与 ES 客户端。
    
- `collector/host_collector/`: 组员 1 负责的主机日志采集。
    
- `collector/network_collector/`: 组员 2 负责的网络流量采集。
    
- `analyzer/attack_analyzer/`: 组员 3 负责的 ATT&CK 映射与时间线关联。
    
- `analyzer/graph_analyzer/`: 组员 4 负责的实体图与路径重建。
    

## 4. 公共模块使用指南 (核心)

为了保证第 3 天的系统集成顺利，所有人必须调用以下接口进行数据读写：

### 4.1 数据规范 (`schema.py`)

所有采集到的日志必须封装为 `UnifiedEvent` 对象。

Python

```
from collector.common.schema import UnifiedEvent, EventInfo, SourceInfo

# 示例：组员 1/2 封装采集数据
event = UnifiedEvent(
    event=EventInfo(
        category="network",      # 类别：process/network/file/authentication
        action="connection_fail",# 具体动作
        severity=5               # 严重程度 1-10
    ),
    source=SourceInfo(ip="1.2.3.4"),
    message="原始日志内容"
)
```

### 4.2 数据库操作 (`es_client.py`)

严禁自行编写 ES 写入逻辑，统一使用 `ESClient`。

Python

```
from collector.common.es_client import ESClient

client = ESClient(hosts=["http://服务器IP:9200"])

# 写入数据（返回事件ID）
event_id = client.write_event(event.to_dict())

# 查询数据（组员 3/4 使用）
logs = client.query_events(start_time="now-1h", end_time="now")
```

## 5. 开发协作流程

1. **路径设置**: 运行代码前请执行 `export PYTHONPATH=$PYTHONPATH:$(pwd)` 以确保模块导入正常。
    
2. **数据对接**: 组员 1 & 2 产出的日志将存入 `unified-logs-*` 索引。
    
3. **每日同步**: 每天 21:00 前请将代码推送至指定分支，由组员 5 进行集成测试。
    

---

## 6. 快速验证

运行以下命令验证你的环境是否可以连接到存储中心：

Bash

```
python3 test_common.py
```

若显示 `查询成功！找回了 1 条测试数据`，则说明你的开发环境已就绪。